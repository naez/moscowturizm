function Blog(){this.comments=[],this.posts=[]}function accordionDestroy(){$(".posts").accordion("destroy")}function accordion(){$(".posts").accordion({animate:200,heightStyle:"content",active:!0})}function Post(t,o,e,s,n){this.id=t,this.userId=o,this.title=e,this.body=s,this.comments=n}Blog.prototype.fetchPosts=function(o){var e=this;$.ajax({url:"http://jsonplaceholder.typicode.com/posts",type:"GET"}).done(function(t){e.posts=t,o()})},Blog.prototype.fetchComments=function(o){$.ajax({url:"http://jsonplaceholder.typicode.com/comments",type:"GET",context:this}).done(function(t){this.comments=t,o()})},Blog.prototype.filterCommentsByPostId=function(o){var e=[];return this.comments.forEach(function(t){t.postId==o&&e.push(t)}),e},Blog.prototype.addPost=function(t,o,e){$.ajax({url:"http://jsonplaceholder.typicode.com/posts",type:"POST",context:this,data:{title:t,body:o,postId:e}}).done(function(t){this.posts.push(t),this.renderPosts()})},Blog.prototype.addComment=function(t,o){$.ajax({url:"http://jsonplaceholder.typicode.com/comments",type:"POST",context:this,data:{body:t,postId:o}}).done(function(t){this.comments.push(t),this.renderPosts()})},Blog.prototype.renderPosts=function(){var s=this;$(".posts").html(""),this.posts.forEach(function(t){var o=s.filterCommentsByPostId(t.id),e=new Post(t.id,t.userId,t.title,t.body,o).render();$(".posts").prepend(e)}),$(".addPost-wrap, .autocomplete").remove(),$(".posts").before('<div class="addPost-wrap">      <h2>Добавить пост</h2>      <div class="form-group">        <input type="text" class="form-control add-title" placeholder="Добавить заголовок" required/>      </div>      <div class="form-group">        <textarea class="form-control add-text" placeholder="Добавить текст"></textarea>      </div>      <button class="btn btn--green addPost">Добавить пост</button>    </div>'),$(".posts").before('<div class="autocomplete">      <h2>Введите название поста</h2>      <div class="form-group">        <input id="autocomplete" type="text" class="form-control add-title" placeholder="Добавить заголовок" required/>        <button class="search btn btn--medium">Поиск</button>      </div>    </div>'),$(".addPost").on("click",function(){var t=$(".add-title").val(),o=$(".add-text").val();t?(s.addPost(t,o),accordionDestroy()):$(".add-title").addClass("error")}),accordion();var t=[];$(".post-title").each(function(){t.push($(this).text())}),$("#autocomplete").autocomplete({source:t}),$(".search").on("click",function(){$(".post-title").filter(function(){return 0!==$(this).text().indexOf($("#autocomplete").val())}).hide().next().hide()}),$("#autocomplete").on("keyup",function(){0==$("#autocomplete").val().length&&$(".post-title").show()})},Post.prototype.render=function(){var o="";return this.comments.forEach(function(t){o+='<p class="comment-item">'+t.body+"</p>"}),'<h3 class="post-title">'+this.title+'</h3>          <div class="post-item">            <div class="post-body">              <p>'+this.body+'</p>              <div class="comments-box">'+o+"</div>            </div>          </div>"};var blog=new Blog;blog.fetchPosts(function(){blog.fetchComments(function(){blog.renderPosts()})});